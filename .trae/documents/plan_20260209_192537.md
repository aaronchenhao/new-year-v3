# 前端API配置修复计划

## 问题分析
- **错误信息**：`POST http://172.18.0.2:3001/api/messages/1 net::ERR_CONNECTION_TIMED_OUT`
- **根本原因**：前端代码硬编码了Docker内部IP地址 `172.18.0.2`，浏览器无法直接访问Docker容器内部IP
- **影响范围**：用户端前端无法与后端服务通信，导致消息提交失败

## 修复方案

### 1. 修改前端API配置
- **文件**：`App.tsx`
- **修改位置**：
  - 第349行：获取消息的API调用
  - 第386行：获取统计的API调用
  - 第518行：提交消息的API调用
- **修改内容**：将硬编码的IP地址替换为相对路径
  - 从：`http://172.18.0.2:3001/api/messages/${myHorse.id}`
  - 到：`/api/messages/${myHorse.id}`

### 2. 配置Nginx反向代理
- **操作**：在1Panel中编辑用户端前端网站的Nginx配置
- **添加反向代理规则**：
  ```nginx
  location /api {
      proxy_pass http://localhost:3001;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
  }
  ```

### 3. 重新构建前端
- **操作**：在本地重新构建前端项目
- **命令**：`npm run build`
- **上传**：将新的构建产物上传到1Panel静态网站目录

### 4. 验证修复
- **前端访问**：打开用户端前端网站
- **功能测试**：测试消息提交功能
- **API测试**：访问 `http://your-domain.com/api/stats`
- **浏览器控制台**：检查是否还有连接错误

## 技术要点
- **相对路径优势**：避免硬编码IP，部署更灵活
- **Nginx反向代理**：统一入口，简化配置
- **Docker网络**：容器内部IP仅用于容器间通信
- **浏览器安全**：浏览器无法直接访问Docker内部网络

## 预期结果
- 前端能够正常与后端通信
- 消息提交功能恢复正常
- API调用无连接超时错误
- 部署配置更灵活，便于后续维护