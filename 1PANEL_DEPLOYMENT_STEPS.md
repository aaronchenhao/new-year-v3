# 腾讯云1Panel部署详细步骤

## 1. 准备工作

### 1.1 登录腾讯云控制台
- 访问 https://console.cloud.tencent.com/
- 登录您的腾讯云账号

### 1.2 创建云服务器实例
- **实例配置**：推荐 2核4G内存，50GB磁盘
- **操作系统**：Ubuntu 22.04 LTS
- **安全组**：开放以下端口
  - 80（HTTP）
  - 443（HTTPS）
  - 3001（用户服务端）
  - 3002（管理端后端）

### 1.3 安装1Panel
- 连接到云服务器（使用SSH工具，如PuTTY或腾讯云Web Shell）
- 执行安装命令：
  ```bash
  curl -sSL https://resource.fit2cloud.com/1panel/package/quick_start.sh | bash
  ```
- 安装完成后，根据提示访问1Panel管理界面（默认地址：`http://服务器IP:4080`）
- 首次登录时设置管理员账号和密码

### 1.4 安装必要组件
在1Panel中安装以下组件：
- **Nginx**：用于部署静态网站
- **Redis**：用于数据存储
- **Node.js 16+**：用于运行后端服务

操作步骤：
1. 登录1Panel管理界面
2. 进入「应用商店」
3. 搜索并安装上述组件

## 2. 部署前端（用户端）

### 2.1 构建前端项目
在本地执行以下命令：
```bash
# 进入项目根目录
cd new-year-v3

# 安装依赖（如果未安装）
npm install

# 构建前端项目
npm run build
```
- 构建产物会生成在 `dist` 目录中

### 2.2 在1Panel中创建静态网站
1. 登录1Panel管理界面
2. 进入「网站」→「创建网站」
3. 填写网站信息：
   - **网站名称**：牛马宇宙前端
   - **域名**：填写您的域名（如无域名，可使用服务器IP）
   - **网站类型**：静态网站
   - **根目录**：选择一个目录，如 `/www/wwwroot/horse-universe-frontend`
   - **PHP版本**：无（静态网站不需要PHP）
   - **数据库**：无（静态网站不需要数据库）
4. 点击「提交」创建网站

### 2.3 上传构建产物
1. 在1Panel中，进入刚创建的网站详情页
2. 点击「文件管理」
3. 将本地 `dist` 目录中的所有文件上传到网站根目录
4. 确保文件上传完整

### 2.4 配置Nginx（可选）
如果需要配置反向代理或其他Nginx设置：
1. 在网站详情页，点击「配置文件」→「Nginx配置」
2. 根据需要修改配置文件
3. 点击「保存」并「重载配置」

## 3. 部署用户服务端

### 3.1 在1Panel中创建Node.js应用
1. 登录1Panel管理界面
2. 进入「应用」→「Node.js应用」→「创建应用」
3. 填写应用信息：
   - **应用名称**：牛马宇宙用户服务端
   - **运行目录**：选择一个目录，如 `/www/wwwroot/horse-universe-backend`
   - **启动文件**：`server.js`
   - **端口**：3001
   - **Node.js版本**：16+（选择已安装的版本）
4. 点击「提交」创建应用

### 3.2 上传代码
1. 在应用详情页，点击「文件管理」
2. 将本地 `server` 目录中的所有文件上传到应用运行目录
3. 确保文件上传完整，包括：
   - `server.js`
   - `package.json`
   - `package-lock.json`

### 3.3 安装依赖
1. 在应用详情页，点击「依赖管理」
2. 点击「安装依赖」
3. 执行 `npm install` 命令
4. 等待依赖安装完成

### 3.4 配置环境变量
1. 在应用详情页，点击「环境变量」
2. 点击「添加环境变量」
3. 添加以下环境变量：
   | 变量名 | 值 | 说明 |
   |-------|-----|------|
   | `REDIS_HOST` | `localhost` | Redis服务器地址（如果Redis在本地） |
   | `REDIS_PORT` | `6379` | Redis端口 |
   | `REDIS_PASSWORD` | `your_redis_password` | Redis密码（如果设置了密码） |
   | `PORT` | `3001` | 服务端口 |
   | `GEMINI_API_KEY` | `your_gemini_api_key` | Google Gemini API密钥（可选） |
4. 点击「保存」

### 3.5 启动应用
1. 在应用详情页，点击「启动」按钮
2. 查看「运行状态」，确保应用正常运行
3. 点击「日志」查看启动日志，确保无错误信息

## 4. 部署管理端

### 4.1 部署管理端前端
1. 在1Panel中，进入「网站」→「创建网站」
2. 填写网站信息：
   - **网站名称**：牛马宇宙管理端前端
   - **域名**：填写您的域名（如无域名，可使用服务器IP+路径，如 `http://服务器IP:8080`）
   - **网站类型**：静态网站
   - **根目录**：选择一个目录，如 `/www/wwwroot/horse-universe-admin-frontend`
3. 点击「提交」创建网站
4. 在网站详情页，点击「文件管理」
5. 将本地 `admin/client` 目录中的所有文件上传到网站根目录

### 4.2 部署管理端后端
1. 在1Panel中，进入「应用」→「Node.js应用」→「创建应用」
2. 填写应用信息：
   - **应用名称**：牛马宇宙管理端后端
   - **运行目录**：选择一个目录，如 `/www/wwwroot/horse-universe-admin-backend`
   - **启动文件**：`index.js`
   - **端口**：3002
   - **Node.js版本**：16+（选择已安装的版本）
3. 点击「提交」创建应用
4. 在应用详情页，点击「文件管理」
5. 将本地 `admin/server` 目录中的所有文件上传到应用运行目录
6. 点击「依赖管理」→「安装依赖」，执行 `npm install`
7. 点击「环境变量」→「添加环境变量」，添加以下环境变量：
   | 变量名 | 值 | 说明 |
   |-------|-----|------|
   | `REDIS_HOST` | `localhost` | Redis服务器地址 |
   | `REDIS_PORT` | `6379` | Redis端口 |
   | `REDIS_PASSWORD` | `your_redis_password` | Redis密码（如果设置了密码） |
   | `ADMIN_PORT` | `3002` | 服务端口 |
   | `ADMIN_PASSWORD` | `your_admin_password` | 管理端登录密码（建议设置强密码） |
8. 点击「启动」按钮启动应用
9. 查看「运行状态」和「日志」，确保应用正常运行

## 5. 配置域名和SSL（可选）

### 5.1 域名解析
如果使用域名：
1. 在域名提供商处，将域名解析到您的服务器IP
2. 等待域名解析生效（通常需要几分钟到几小时）

### 5.2 SSL证书
1. 在1Panel中，进入「网站」→「SSL证书」
2. 点击「申请证书」（使用Let's Encrypt免费证书）
3. 填写证书信息：
   - **域名**：填写您的域名
   - **邮箱**：填写您的邮箱（用于证书到期提醒）
4. 点击「提交」申请证书
5. 证书申请成功后，点击「启用」
6. 确保HTTPS访问正常

## 6. 测试和验证

### 6.1 前端测试
1. 访问前端域名（或服务器IP）
2. 确保页面正常加载
3. 测试游戏功能，确保与后端服务正常通信

### 6.2 用户服务端测试
1. 访问 `http://服务器IP:3001/api/stats`（或使用域名）
2. 确保返回正常的JSON数据
3. 查看应用日志，确保无错误信息

### 6.3 管理端测试
1. 访问管理端前端域名（或服务器IP+路径）
2. 使用配置的管理端密码登录
3. 测试管理功能，确保与管理端后端正常通信

### 6.4 Redis连接测试
1. 在1Panel中，进入「应用」→「Redis」
2. 点击「管理」进入Redis管理界面
3. 执行简单的Redis命令，确保Redis服务正常运行
4. 检查用户服务端和管理端后端的日志，确保Redis连接正常

## 7. 常见问题排查

### 7.1 服务无法启动
- 检查端口是否被占用
- 检查环境变量配置是否正确
- 查看应用日志，分析错误原因
- 检查Node.js版本是否兼容

### 7.2 前端无法连接后端
- 检查后端服务是否正常运行
- 检查前端API地址配置是否正确（如果前端硬编码了API地址）
- 检查防火墙设置，确保端口开放
- 检查CORS配置是否正确

### 7.3 Redis连接失败
- 检查Redis服务是否正常运行
- 检查Redis配置是否正确（主机、端口、密码）
- 检查网络连接是否正常
- 查看应用日志，分析错误原因

### 7.4 管理端登录失败
- 检查管理端密码是否正确
- 检查管理端后端服务是否正常运行
- 检查环境变量 `ADMIN_PASSWORD` 是否正确设置
- 查看管理端后端日志，分析错误原因

## 8. 维护和更新

### 8.1 代码更新
- **前端**：重新构建并上传 `dist` 目录
- **后端**：上传更新的代码，重启应用

### 8.2 依赖更新
- 在应用管理中，点击「依赖管理」→「更新依赖」
- 执行 `npm update` 命令

### 8.3 日志管理
- 在1Panel中，查看应用日志，及时发现和解决问题
- 定期清理日志文件，避免磁盘空间不足

### 8.4 备份
- 定期备份代码和数据
- 使用1Panel的「备份」功能，备份网站和应用

## 9. 安全建议

### 9.1 密码安全
- 为管理端设置强密码
- 定期更换密码
- 避免使用默认密码

### 9.2 访问控制
- 为管理端设置IP访问限制
- 使用HTTPS加密传输
- 避免在公网暴露敏感端口

### 9.3 系统安全
- 定期更新服务器系统和软件
- 关闭不必要的服务和端口
- 使用防火墙限制访问

### 9.4 数据安全
- 定期备份Redis数据
- 避免在代码中硬编码敏感信息
- 使用环境变量存储敏感配置

---

## 10. 总结

通过以上步骤，您可以成功将牛马宇宙项目的前端、用户服务端和管理端部署到腾讯云1Panel平台。部署完成后，您可以通过域名或服务器IP访问项目，享受完整的游戏功能和管理功能。

如果在部署过程中遇到任何问题，请参考「常见问题排查」部分，或联系腾讯云技术支持获取帮助。

祝您部署顺利！